"use strict";(self.webpackChunkvite_ml_platform=self.webpackChunkvite_ml_platform||[]).push([[970],{54233:(e,o,i)=>{i.d(o,{G:()=>l,j:()=>t});var n=i(14556);const t=()=>(0,n.wA)(),l=n.d4},43970:(e,o,i)=>{i.r(o),i.d(o,{default:()=>Me});var n=i(65043),t=i(48330),l=i(13706),a=i(20751),s=i(93589),r=i(42463),d=i(63485),c=i(11638),p=i(79169),u=i(54233),m=i(31083);function x(e,o){let i=null;return function(){for(var n=arguments.length,t=new Array(n),l=0;l<n;l++)t[l]=arguments[l];clearTimeout(i),i=window.setTimeout((()=>e.apply(this,t)),o)}}var h=i(13349);const g={modalStyles:(0,h.Zq)({position:"fixed",width:"100%",height:"100vh",backgroundColor:"rgba(0, 0, 0, .5)",zIndex:999,display:"flex",justifyContent:"center",alignItems:"center"}),cancelIcon:{iconName:"Cancel"},contentStyles:(0,h.l8)({container:{minWidth:"75%",minHeight:"80%",overflow:"hidden",display:"flex",borderRadius:2,backgroundColor:"#fff",padding:"0 24px"},header:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"10px 0 14px 0"},body:{flex:1,height:0,position:"relative",display:"flex"},footer:{position:"relative",display:"flex",padding:"24px 0",justifyContent:"flex-end"}}),resizeLine:(0,h.Zq)({width:8,height:"100%",cursor:"col-resize",background:"#eee",transition:"background 0.2s",margin:"0 15px 0 2px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"}),resizeLineIconStyles:(0,h.Zq)({display:"flex",justifyContent:"center",alignItems:"center",boxSizing:"border-box",paddingRight:"19px",width:8,height:20,fontSize:20,pointerEvents:"none"})};var v=i(74117),b=i(70579);const f=()=>{const e=(0,u.j)(),o=(0,u.G)(m.h4),i=(0,u.G)(m.m3),[x,h]=(0,n.useState)(""),[f,j]=(0,n.useState)("100%"),[y,w]=(0,n.useState)(!1),[S,k]=(0,n.useState)(!1),{t:C,i18n:N}=(0,v.Bd)(),_=()=>{k(!1),e((0,m.YT)(!1))},L=()=>{w(!1)};return(0,n.useEffect)((()=>{h(i)}),[o]),(0,b.jsx)("div",{className:g.modalStyles,style:{display:o?"flex":"none"},children:(0,b.jsxs)(t.B,{className:g.contentStyles.container,children:[(0,b.jsxs)("div",{className:g.contentStyles.header,children:[(0,b.jsx)("span",{children:"JSON Editor"}),(0,b.jsx)(l.K,{iconProps:g.cancelIcon,onClick:_})]}),(0,b.jsxs)("div",{className:g.contentStyles.body,onMouseMove:e=>{y&&e.clientX>370&&j(e.clientX-270)},onMouseUp:L,onMouseLeave:L,children:[(0,b.jsx)("div",{style:{height:"100%",width:f},children:(0,b.jsx)(p.Ay,{language:"json",theme:"vs",value:x,onChange:e=>{k(!1),h(e)},height:500,options:{renderValidationDecorations:"on",automaticLayout:!0,formatOnPaste:!0,formatOnType:!0,renderLineHighlight:"none",autoClosingOvertype:"always",cursorStyle:"block",quickSuggestions:!1,scrollBeyondLastLine:!1,snippetSuggestions:"none",minimap:{enabled:!1}}})}),(0,b.jsx)("div",{className:g.resizeLine,onMouseDown:()=>{w(!0)},children:(0,b.jsx)(a.I,{iconName:"BulletedListBulletMirrored",className:g.resizeLineIconStyles})}),(0,b.jsx)("div",{style:{flex:1}})]}),(0,b.jsxs)("div",{className:g.contentStyles.footer,children:[S?(0,b.jsx)(s.n,{messageBarType:r.H.error,styles:{root:{position:"absolute",width:"50%",left:0}},isMultiline:!1,children:C("JSON \u683c\u5f0f\u9519\u8bef")}):null,(0,b.jsx)(d.j,{styles:{root:{marginRight:10}},onClick:()=>{!function(e){try{return JSON.parse(e),!0}catch(o){return!1}}(x)?k(!0):(e((0,m.zv)(x)),e((0,m.YT)(!1)))},children:C("\u786e\u8ba4")}),(0,b.jsx)(c.Y,{onClick:_,children:C("\u53d6\u6d88")})]})]})})};var j=i(23212),y=i(50864),w=i(40488),S=i(57433),k=i(85893),C=i(60392),N=i(66669),_=i(78926),L=i(20434),I=i(64591),B=i(36830),q=i(6948);const D={settingContainer:(0,h.Zq)({display:"flex",flexDirection:"column",width:350,position:"absolute",top:0,right:0,bottom:0,height:"auto",backgroundColor:"#fff",borderLeft:"1px solid rgb(234, 234, 234)",boxShadow:"rgb(0 0 0 / 18%) 0px 1.6px 3.6px 0px, rgb(0 0 0 / 22%) 0px 0.3px 0.9px 0px",zIndex:999}),settingHeader:(0,h.Zq)({display:"flex",width:"100%",alignItems:"center",justifyContent:"space-between",color:"balck",boxSizing:"border-box",padding:"10px 20px"}),headerTitle:(0,h.Zq)({fontSize:20,fontWeight:600,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",color:"black"}),settingContent:(0,h.Zq)({flex:"1 1 0%",overflowY:"auto","&::-webkit-scrollbar":{width:4},"&::-webkit-scrollbar-thumb":{minHeight:"15px",border:"6px solid transparent",backgroundClip:"padding-box",backgroundColor:"rgb(200, 200, 200)"}}),contentWrapper:(0,h.Zq)({padding:"0 20px 20px",overflowX:"hidden",wordBreak:"break-word",userSelect:"text",borderTop:"1px solid #eaeaea"}),splitLine:(0,h.Zq)({margin:"10px -20px 0 -20px",borderTop:"1px solid #eaeaea"})};var Z=i(89205),G=i(16991),O=(i(38383),i(33486)),T=i(86178),A=i.n(T);const z=()=>{const e=(0,u.j)(),o=(0,u.G)(j.Bk),i=(0,u.G)(L._8),t=(0,u.G)(j.pV),a=(0,u.G)(_.Cq),[s,r]=(0,n.useState)({}),[d,c]=(0,n.useState)([]),[p,m]=(0,n.useState)(),{t:x,i18n:h}=(0,v.Bd)(),g=(i,n)=>{const l={};if(l[i]=n,"project"===i){const e=n;m(e),l[i]=e.key}o&&(r({...s,...l}),e((0,j._Q)({...t,...l})))};return(0,n.useEffect)((()=>{if(o){var e,i;r(o);const n={key:null===o||void 0===o||null===(e=o.project)||void 0===e?void 0:e.id,text:null===o||void 0===o||null===(i=o.project)||void 0===i?void 0:i.name};m(n)}}),[o]),(0,n.useEffect)((()=>{Object.keys(t).length>1&&e((0,j.Eh)(!0))}),[t]),(0,n.useEffect)((()=>{C.A.project_modelview().then((e=>{const o=null===e||void 0===e?void 0:e.result.data.reduce(((e,o)=>{if("org"===o.type){const i={key:o.id,text:o.name};e.push(i)}return e}),[]);c(o)}))}),[]),(0,n.useEffect)((()=>{const o={};a.forEach((e=>{if((0,k.UP)(e)){var i;const n=a.filter((o=>o.id===e.source))[0],t=a.filter((o=>o.id===e.target))[0];null!==(i=o["".concat(t.data.name)])&&void 0!==i&&i.upstream?o["".concat(t.data.name)].upstream.push("".concat(n.data.name)):(o["".concat(t.data.name)]={},o["".concat(t.data.name)].upstream=["".concat(n.data.name)])}}));const i={...o};r({...s,dag_json:JSON.stringify(i,void 0,4)}),e((0,j._Q)({...t,dag_json:JSON.stringify(i)}))}),[a]),(0,b.jsxs)("div",{style:{visibility:i?"visible":"hidden"},className:D.settingContainer,children:[(0,b.jsxs)("div",{className:D.settingHeader,children:[(0,b.jsx)("div",{className:D.headerTitle,children:x("\u6d41\u6c34\u7ebf\u8bbe\u7f6e")}),(0,b.jsx)(l.K,{iconProps:{iconName:"ChromeClose",styles:{root:{fontSize:12,color:"#000"}}},onClick:()=>{e((0,L.L$)())}})]}),(0,b.jsx)("div",{className:D.settingContent,children:(0,b.jsxs)("div",{className:D.contentWrapper,children:[(0,b.jsx)(B.m,{label:x("\u9879\u76ee\u7ec4"),onChange:(e,o)=>{g("project",o||"")},selectedKey:p?p.key:void 0,placeholder:"Select an option",options:d}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u540d\u79f0"),description:x("\u82f1\u6587\u540d(\u5b57\u6bcd\u3001\u6570\u5b57\u3001- \u7ec4\u6210)\uff0c\u6700\u957f50\u4e2a\u5b57\u7b26"),onChange:(e,o)=>{g("name",o||"")},value:(null===s||void 0===s?void 0:s.name)||"",disabled:!0}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u63cf\u8ff0"),required:!0,onChange:(e,o)=>{g("describe",o||"")},value:(null===s||void 0===s?void 0:s.describe)||""}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(B.m,{label:x("\u8c03\u5ea6\u4f18\u5148\u7ea7"),options:[{key:"\u9ad8\u4f18\u5148\u7ea7",text:"\u9ad8\u4f18\u5148\u7ea7"},{key:"\u4f4e\u4f18\u5148\u7ea7",text:"\u4f4e\u4f18\u5148\u7ea7"}]}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(B.m,{label:x("\u8c03\u5ea6\u7c7b\u578b"),options:[{key:"once",text:"once"},{key:"crontab",text:"crontab"}],selectedKey:null===s||void 0===s?void 0:s.schedule_type,onChange:(e,o)=>{g("schedule_type","".concat(null===o||void 0===o?void 0:o.text)||"")}}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u8c03\u5ea6\u5468\u671f"),description:x("\u5468\u671f\u4efb\u52a1\u7684\u65f6\u95f4\u8bbe\u5b9a * * * * * \u8868\u793a\u4e3a minute hour day month week"),onChange:(e,o)=>{g("cron_time",o||"")},value:(null===s||void 0===s?void 0:s.cron_time)||""}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)("div",{style:{fontWeight:600,padding:"5px 0px"},children:x("\u76d1\u63a7\u72b6\u6001")}),(0,b.jsx)(Z.A,{style:{width:"100%",border:"1px solid rgb(55, 55, 55)"},value:null!==s&&void 0!==s&&s.alert_status?((null===s||void 0===s?void 0:s.alert_status)||"").split(","):void 0,onChange:e=>{g("alert_status",(e||[]).join(","))},mode:"multiple",options:[{label:"Created",value:"Created"},{label:"Pending",value:"Pending"},{label:"Running",value:"Running"},{label:"Succeeded",value:"Succeeded"},{label:"Failed",value:"Failed"},{label:"Unknown",value:"Unknown"},{label:"Waiting",value:"Waiting"},{label:"Terminated",value:"Terminated"}]}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u62a5\u8b66\u4eba"),description:x("\u6bcf\u4e2a\u7528\u6237\u4f7f\u7528\u82f1\u6587\u9017\u53f7\u5206\u9694"),onChange:(e,o)=>{g("alert_user",o||"")},value:(null===s||void 0===s?void 0:s.alert_user)||""}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)("div",{style:{fontWeight:600,padding:"5px 0px"},children:x("\u8865\u5f55\u8d77\u70b9")}),(0,b.jsx)(G.A,{style:{width:"100%",border:"1px solid rgb(55, 55, 55)"},locale:O.A,showTime:!0,value:null!==s&&void 0!==s&&s.cronjob_start_time?A()(null===s||void 0===s?void 0:s.cronjob_start_time):void 0,onChange:(e,o)=>{g("cronjob_start_time",o)},disabledDate:e=>e&&e>A()().endOf("day")}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(B.m,{label:x("\u8fc7\u5f80\u4f9d\u8d56"),options:[{key:"true",text:x("\u662f"),data:!0},{key:"false",text:x("\u5426"),data:!1}],selectedKey:"".concat(s.depends_on_past),onChange:(e,o)=>{g("depends_on_past",null===o||void 0===o?void 0:o.data)}}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u6700\u5927\u6fc0\u6d3b\u8fd0\u884c\u6570"),description:x("\u5f53\u524dpipeline\u53ef\u540c\u65f6\u8fd0\u884c\u7684\u4efb\u52a1\u6d41\u5b9e\u4f8b\u6570\u76ee"),onChange:(e,o)=>{g("max_active_runs",o?+o:"")},value:(null===s||void 0===s?void 0:s.max_active_runs)||"",required:!0}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u4efb\u52a1\u5e76\u884c\u6570"),description:x("pipeline\u4e2d\u53ef\u540c\u65f6\u8fd0\u884c\u7684task\u6570\u76ee"),onChange:(e,o)=>{g("parallelism",o?+o:"")},value:(null===s||void 0===s?void 0:s.parallelism)||"",required:!0}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u6d41\u5411\u56fe"),onChange:(e,o)=>{g("dag_json",o||"{}")},value:(null===s||void 0===s?void 0:s.dag_json)||"{}",multiline:!0,autoAdjustHeight:!0,disabled:!0}),(0,b.jsx)("div",{className:D.splitLine}),(0,b.jsx)(q.A,{label:x("\u5168\u5c40\u73af\u5883\u53d8\u91cf"),description:x("\u4e3a\u6bcf\u4e2atask\u90fd\u6dfb\u52a0\u7684\u516c\u5171\u53c2\u6570"),onChange:(e,o)=>{g("global_env",o||"")},multiline:!0,autoAdjustHeight:!0,value:(null===s||void 0===s?void 0:s.global_env)||""})]})})]})};var E=i(77774),H=i(26498),W=i(8784),M=i(31537);const R={modelContainer:(0,h.Zq)({display:"flex",flexDirection:"column",width:350,position:"absolute",top:0,right:0,bottom:0,height:"auto",backgroundColor:"#fff",borderLeft:"1px solid rgb(234, 234, 234)",boxShadow:"rgb(0 0 0 / 18%) 0px 1.6px 3.6px 0px, rgb(0 0 0 / 22%) 0px 0.3px 0.9px 0px",zIndex:998}),modelHeader:(0,h.Zq)({display:"flex",width:"100%",alignItems:"center",justifyContent:"space-between",color:"balck",boxSizing:"border-box",padding:"10px 20px"}),headerTitle:(0,h.Zq)({fontSize:20,textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",color:"black",fontWeight:600}),modelContent:(0,h.Zq)({flex:"1 1 0%",overflowY:"auto","&::-webkit-scrollbar":{width:4},"&::-webkit-scrollbar-thumb":{minHeight:"15px",border:"6px solid transparent",backgroundClip:"padding-box",backgroundColor:"rgb(200, 200, 200)"}}),contentWrapper:(0,h.Zq)({padding:"0 20px 20px",overflowX:"hidden",wordBreak:"break-word",userSelect:"text",borderTop:"1px solid #eaeaea"}),splitLine:(0,h.Zq)({margin:"10px -20px 0 -20px",borderTop:"1px solid #eaeaea"}),settingControl:(0,h.Zq)({height:"auto",display:"flex",flexDirection:"column",paddingTop:20}),saveButton:(0,h.Zq)({alignSelf:"center"}),debugButton:(0,h.Zq)({display:"flex",flexDirection:"row",justifyContent:"space-evenly",paddingTop:20}),templateConfig:(0,h.Zq)({color:"rgb(96, 94, 92)",fontSize:10,paddingTop:5,paddingLeft:2,"> a":{textDecoration:"none"}}),argsDescription:(0,h.Zq)({color:"rgb(96, 94, 92)",fontSize:10,"> a":{textDecoration:"none"}}),textLabelStyle:(0,h.Zq)({display:"flex",alignItems:"center",justifyContent:"space-between",fontWeight:600,color:"rgb(50, 49, 48)",boxSizing:"border-box",boxShadow:"none",margin:"0px",padding:"5px 0px",overflowWrap:"break-word",lineHeight:"30px"})};var J=i(41264);const P=e=>{const o=(0,u.j)(),i=(0,u.G)(_.Cq),t=(0,u.G)(I.rp),l=(0,u.G)(m.h4),a=(0,u.G)(m.um),s=(0,u.G)(m.m3),[r,d]=(0,n.useState)({}),[c,p]=(0,n.useState)({}),[x,h]=(0,n.useState)({}),[g,f]=(0,n.useState)({}),[j,y]=(0,n.useState)({}),{t:w,i18n:S}=(0,v.Bd)(),k=[{key:"debug",text:"debug",onClick:()=>L("debug"),iconProps:{iconName:"Bug"}},{key:"run",text:"run",onClick:()=>L("run"),iconProps:{iconName:"Play"}},{key:"log",text:"log",onClick:()=>L("log"),iconProps:{iconName:"TimeEntry"}},{key:"clear",text:"clear",onClick:()=>L("clear"),iconProps:{iconName:"Unsubscribe"}}],L=o=>{e.model.id&&window.open("".concat(window.location.origin,"/task_modelview/api/").concat(o,"/").concat(e.model.id))},D=(e,o,i)=>{const n={};let t=null;switch(i){case"json":try{t=JSON.parse("".concat(o))}catch(l){t=o}break;case"int":t=+o;break;default:t=o}if(i){const o=JSON.parse(JSON.stringify(j));o[e]=t,n.args=JSON.stringify(o)}else n[e]=o;p({...c,...n}),d({...r,...n}),null!==n&&void 0!==n&&n.args&&y({...j,...JSON.parse(n.args)})};return(0,n.useEffect)((()=>{e.model.selected&&(o((0,I.Mb)(+e.model.id)),0===Object.keys(r).length&&C.A.task_modelview_get(+e.model.id).then((e=>{if(0===e.status){const o=JSON.parse(e.result.args),i=e.result.job_template,n=null!==i&&void 0!==i&&i.args?JSON.parse(i.args):{},t=Object.keys(n).reduce(((e,o)=>{const i=n[o];return Object.keys(i).forEach((o=>{e[o]=i[o].default})),e}),{});d(e.result),y(Object.assign(t,o)),f(n),h(i)}})).catch((e=>{e.response&&o((0,N.IV)({msg:e.response.data.message}))})))}),[e.model.selected]),(0,n.useEffect)((()=>{if(e.model.id&&o((0,I.dE)({id:+e.model.id,changed:c})),null!==c&&void 0!==c&&c.label){const n=i.map((o=>{if(o.id===e.model.id){const e={...o.data,label:c.label};return{...o,data:e}}return o}));o((0,_.VC)(n))}}),[c]),(0,n.useEffect)((()=>{Object.keys(g).length>0&&+e.model.id===t&&!l&&D(a,s,"json")}),[s]),(0,b.jsxs)("div",{className:R.modelContainer,style:{visibility:e.model.selected?"visible":"hidden"},children:[(0,b.jsx)("div",{className:R.modelHeader,children:(0,b.jsx)("div",{className:R.headerTitle,children:(null===r||void 0===r?void 0:r.name)||""})}),(0,b.jsx)("div",{className:R.modelContent,children:(0,b.jsxs)("div",{className:R.contentWrapper,children:[(0,b.jsx)(H.r,{items:k,overflowItems:[],styles:{root:{padding:0}}}),(0,b.jsx)(q.A,{label:w("\u4efb\u52a1\u6a21\u677f"),value:(null===x||void 0===x?void 0:x.name)||"",disabled:!0,readOnly:!0,onRenderDescription:()=>{let e="";try{var o;if(x.expand)e=(null===(o=JSON.parse(x.expand))||void 0===o?void 0:o.help_url)||""}catch(i){console.error(i)}return(0,b.jsx)("div",{className:R.templateConfig,children:e?(0,b.jsx)("a",{href:e,target:"_blank",rel:"noreferrer",children:w("\u914d\u7f6e\u6587\u6863")}):null})}}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("\u6a21\u677f\u63cf\u8ff0"),value:(null===x||void 0===x?void 0:x.describe)||"",disabled:!0,readOnly:!0}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("\u540d\u79f0"),onChange:(e,o)=>{D("name",o||"")},value:(null===r||void 0===r?void 0:r.name)||"",disabled:!0}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("\u6807\u7b7e"),description:w("\u8282\u70b9\u6807\u7b7e"),required:!0,onChange:(e,o)=>{D("label",o||"")},value:(null===r||void 0===r?void 0:r.label)||""}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("\u5185\u5b58\u7533\u8bf7"),description:w("\u5185\u5b58\u7684\u8d44\u6e90\u4f7f\u7528\u9650\u5236\uff0c\u793a\u4f8b1G\uff0c10G\uff0c \u6700\u5927100G\uff0c\u5982\u9700\u66f4\u591a\u8054\u7cfb\u7ba1\u7406\u5458"),onChange:(e,o)=>{D("resource_memory",o||"")},value:(null===r||void 0===r?void 0:r.resource_memory)||"",required:!0}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("CPU\u7533\u8bf7"),description:w("CPU\u7684\u8d44\u6e90\u4f7f\u7528\u9650\u5236(\u5355\u4f4d\u6838)\uff0c\u793a\u4f8b 0.4\uff0c10\uff0c\u6700\u592750\u6838\uff0c\u5982\u9700\u66f4\u591a\u8054\u7cfb\u7ba1\u7406\u5458"),onChange:(e,o)=>{D("resource_cpu",o||"")},value:(null===r||void 0===r?void 0:r.resource_cpu)||"",required:!0}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("GPU\u7533\u8bf7"),description:w("gpu\u7684\u8d44\u6e90\u4f7f\u7528\u9650\u5236(\u5355\u4f4d\u5361)\uff0c\u793a\u4f8b:1\uff0c2\uff0c\u8bad\u7ec3\u4efb\u52a1\u6bcf\u4e2a\u5bb9\u5668\u72ec\u5360\u6574\u5361\u3002\u7533\u8bf7\u5177\u4f53\u7684\u5361\u578b\u53f7\uff0c\u53ef\u4ee5\u7c7b\u4f3c 1(V100),\u76ee\u524d\u652f\u6301T4/V100/A100/VGPU"),onChange:(e,o)=>{D("resource_gpu",o||"")},value:(null===r||void 0===r?void 0:r.resource_gpu)||""}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("RDMA\u7533\u8bf7"),description:w("RDMA\u7684\u8d44\u6e90\u4f7f\u7528\u9650\u5236\uff0c\u793a\u4f8b 0\uff0c1\uff0c10\uff0c\u586b\u5199\u65b9\u5f0f\u54a8\u8be2\u7ba1\u7406\u5458"),onChange:(e,o)=>{D("resource_rdma",o||"")},value:(null===r||void 0===r?void 0:r.resource_rdma)||"",disabled:!0}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("\u8d85\u65f6\u4e2d\u65ad"),description:w("task\u8fd0\u884c\u65f6\u957f\u9650\u5236\uff0c\u4e3a0\u8868\u793a\u4e0d\u9650\u5236(\u5355\u4f4ds)"),onChange:(e,o)=>{D("timeout",o||"")},value:(null===r||void 0===r?void 0:r.timeout)||0}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)(q.A,{label:w("\u91cd\u8bd5\u6b21\u6570"),description:w("task\u91cd\u8bd5\u6b21\u6570"),onChange:(e,o)=>{D("retry",o||"")},value:(null===r||void 0===r?void 0:r.retry)||0}),(0,b.jsx)("div",{className:R.splitLine}),(0,b.jsx)("div",{style:{fontWeight:600,padding:"5px 0px"},children:w("\u662f\u5426\u8df3\u8fc7")}),(0,b.jsx)(J.A,{checkedChildren:w("\u662f"),unCheckedChildren:w("\u5426"),checked:!(null===r||void 0===r||!r.skip),onChange:e=>{D("skip",e)}}),Object.keys(g).reduce(((e,i)=>{const t=g[i],l=Object.keys(t).map((e=>{const i=t[e],{choice:l}=i,a=l.map((e=>({key:e,text:e}))),s=j&&j[e],r="json"===i.type?JSON.stringify(s,void 0,4):s;return(0,b.jsx)(n.Fragment,{children:a.length>0?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(B.m,{label:"".concat(e),onChange:(o,n)=>{D(e,"".concat(null===n||void 0===n?void 0:n.text)||"",i.type)},defaultSelectedKey:r||i.default,options:a,required:1===i.require,disabled:1!==i.editable}),(0,b.jsx)("div",{className:R.argsDescription,dangerouslySetInnerHTML:{__html:i.describe}})]}):(0,b.jsx)(q.A,{onRenderLabel:()=>(0,b.jsxs)("div",{className:R.textLabelStyle,children:["".concat(e),"json"===i.type?(0,b.jsx)(W.r,{iconProps:{iconName:"FullWidthEdit"},onClick:()=>{o((0,m.sv)({key:e,value:r})),o((0,m.YT)(!0))},children:w("\u7f16\u8f91")}):null]}),onRenderDescription:()=>(0,b.jsx)("div",{className:R.argsDescription,dangerouslySetInnerHTML:{__html:i.describe}}),multiline:"str"!==i.type,autoAdjustHeight:"str"!==i.type,onChange:(o,n)=>{D(e,n||"",i.type)},value:r,required:1===i.require,disabled:1!==i.editable||"json"===i.type})},e)}));return e.push((0,b.jsxs)(n.Fragment,{children:[(0,b.jsxs)(M.J,{children:[w("\u53c2\u6570")," ",i]}),l.flat(),(0,b.jsx)("div",{className:R.splitLine})]},i)),e}),[])]})})]})},V={height:54,minWidth:272,borderRadius:100,borderStyle:"solid",display:"flex",flexDirection:"row",backgroundColor:"#fff",fontSize:12,cursor:"move",boxSizing:"border-box",transition:"all 0.3s"},F=(0,h.Zq)({...V,borderWidth:1,borderColor:"#b1b1b7"}),U=(0,h.Zq)({...V,borderWidth:1,borderColor:"#006dce",backgroundColor:"#f1f7fd"}),Y=(0,h.Zq)({width:8,flexShrink:0,borderRadius:"3px 0 0 3px",borderRight:"1px solid #8a8886",margin:"-8px 0 -8px -8px"}),X=(0,h.Zq)({boxSizing:"border-box",display:"flex",flexDirection:"column",overflow:"hidden"}),K=(0,h.Zq)({display:"flex",marginLeft:7,minHeight:26}),$=(0,h.Zq)({fontSize:16,width:64,display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"rgb(0, 120, 212)",borderTopLeftRadius:100,borderBottomLeftRadius:100,margin:"-1px 0 -1px -1px"}),Q=(0,h.Zq)({userSelect:"none",boxSizing:"border-box",color:"#fff",fontSize:20,marginLeft:8}),ee=(0,h.Zq)({whiteSpace:"nowrap",textOverflow:"ellipsis",overflow:"hidden",paddingLeft:8,paddingBottom:2,marginBottom:2,fontWeight:600,fontSize:14,borderBottom:"1px dashed #c1c1c1",userSelect:"none"}),oe=(0,h.Zq)({width:"12px !important",height:"12px !important",bottom:"-7px !important",borderColor:"#b1b1b7 !important",backgroundColor:"#fff !important",transition:"all 0.3s","&:hover":{borderWidth:"2px !important",borderColor:"var(--hover-color) !important",cursor:"pointer !important"}}),ie=(0,h.Zq)({visibility:"hidden"}),ne=(0,h.Zq)({height:"100%",width:"100%",display:"flex",justifyContent:"center",flexDirection:"column"}),te={nodeTips:(0,h.Zq)({color:"rgb(177, 177, 183)",paddingLeft:8}),nodeContentWrapper:ne,nodeContainer:F,nodeOnSelect:U,nodeBar:Y,nodeContent:X,nodeConentTitleBar:K,nodeIconWrapper:$,nodeIcon:Q,nodeTitle:ee,handleStyle:oe,hidden:ie};var le=i(20896),ae=i(81333),se=i(61661),re=i(99739);const de={get:e=>{const o=window.localStorage.getItem(e);return o&&o.match(/^(\{|\[).*(?=[}\]])/)?JSON.parse(o):o||""},set:(e,o)=>{window.localStorage.setItem(e,"string"===typeof o?o:JSON.stringify(o))}},ce={dataSet:e=>{var o,i,t,l,s,r,d,c,p,m,x,h;const[g,f]=(0,n.useState)(!1),[y,w]=(0,n.useState)([]),[S,L]=(0,n.useState)(),B=(de.get("job_template").value||[]).reduce(((e,o)=>({...e,[o.name]:o})),{}),q=(0,u.G)(j.GZ),D=(0,u.G)(_.Cq),Z=(0,u.j)(),{t:G,i18n:O}=(0,v.Bd)();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(le.A,{title:G("\u667a\u80fd\u63a8\u8350\u4e0b\u6e38\u8282\u70b9"),visible:g,onCancel:()=>{L(void 0),f(!1)},onOk:()=>{if(!S)return void ae.Ay.warn(G("\u8bf7\u5148\u9009\u62e9\u63a8\u8350\u8282\u70b9"));const o=B[S],i=JSON.parse(o.args),n={};Object.keys(i).reduce(((e,o)=>{const n={};return Object.keys(i[o]).reduce(((e,n)=>{const t=i[o][n].default;return Object.assign(e,{[n]:t}),e}),n),Object.assign(e,n),e}),n);const t={x:e.xPos||0,y:+((null===e||void 0===e?void 0:e.yPos)||0)+100};if(q){Z((0,I.GW)(!0));const e="".concat(o.name.replace(/\.|[\u4e00-\u9fa5]/g,"").replace(/_|\s/g,"-")||"task","-").concat(Date.now()).substring(0,49);C.A.task_modelview_add(q,{job_template:o.id,pipeline:+q,name:e,label:"".concat(G("\u65b0\u5efa")," ").concat(o.name," ").concat(G("\u4efb\u52a1")),volume_mount:"kubeflow-user-workspace(pvc):/mnt,kubeflow-archives(pvc):/archives",image_pull_policy:"Always",working_dir:"",command:"",overwrite_entrypoint:0,node_selector:"cpu=true,train=true",resource_memory:"2G",resource_cpu:"2",resource_gpu:"0",resource_rdma:"0",timeout:0,retry:0,args:JSON.stringify(n)}).then((i=>{var n;if(null!==i&&void 0!==i&&null!==(n=i.result)&&void 0!==n&&n.id){const n={id:"".concat(i.result.id),type:"dataSet",position:t,data:{info:o,name:e,label:"".concat(G("\u65b0\u5efa")," ").concat(o.name," ").concat(G("\u4efb\u52a1"))}};Z((0,j.Eh)(!0)),Z((0,_.VC)(D.concat(n))),setTimeout((()=>{Z((0,j.cG)())}),2e3)}})).catch((e=>{e.response&&Z((0,N.IV)({msg:e.response.data.message}))})).finally((()=>{Z((0,I.GW)(!1)),f(!1)}))}},children:(0,b.jsx)("div",{children:(0,b.jsx)(se.Ay.Group,{onChange:e=>{L(e.target.value)},value:S,children:(0,b.jsx)(re.A,{direction:"vertical",children:y.map((e=>(0,b.jsx)(se.Ay,{value:e.name,children:e.name},"recommend_".concat(e.name))))})})})}),(0,b.jsx)(k.h7,{type:"target",position:k.yX.Top,className:te.handleStyle}),(0,b.jsxs)("div",{className:e.selected?te.nodeOnSelect:te.nodeContainer,style:{borderColor:e.selected?null===e||void 0===e||null===(o=e.data)||void 0===o||null===(i=o.info)||void 0===i||null===(t=i.color)||void 0===t?void 0:t.color:"",backgroundColor:e.selected?null===e||void 0===e||null===(l=e.data)||void 0===l||null===(s=l.info)||void 0===s||null===(r=s.color)||void 0===r?void 0:r.bg:""},children:[(0,b.jsx)("div",{className:te.nodeIconWrapper,style:{backgroundColor:null===e||void 0===e||null===(d=e.data)||void 0===d||null===(c=d.info)||void 0===c||null===(p=c.color)||void 0===p?void 0:p.color},children:(0,b.jsx)(a.I,{iconName:"Database",className:te.nodeIcon})}),(0,b.jsxs)("div",{className:te.nodeContentWrapper,children:[(0,b.jsx)("div",{className:te.nodeTitle,children:null===e||void 0===e||null===(m=e.data)||void 0===m?void 0:m.label}),null!==e&&void 0!==e&&null!==(x=e.data)&&void 0!==x&&x.info?(0,b.jsx)("div",{className:te.nodeTips,children:null===e||void 0===e||null===(h=e.data)||void 0===h?void 0:h.info.describe}):null]})]}),(0,b.jsx)(k.h7,{type:"source",onClick:()=>{var o,i;console.log("props",e);let n=null===(o=e.data)||void 0===o||null===(i=o.info)||void 0===i?void 0:i.expand;var t,l;"[object String]"===Object.prototype.toString.call(n)&&(n=JSON.parse((null===(t=e.data)||void 0===t||null===(l=t.info)||void 0===l?void 0:l.expand)||"{}"));const a=n.rec_job_template;a&&(w([B[a]]),f(!0))},position:k.yX.Bottom,className:te.handleStyle}),(0,b.jsx)(E.W,{hostId:"hostId_model",className:"data-set-layer",children:(0,b.jsx)(P,{model:e})})]})}},pe={itemStyles:(0,h.Zq)({position:"relative"}),flowWrapper:(0,h.Zq)({width:"100%",height:"100%"}),spinnerWrapper:(0,h.Zq)({position:"absolute",top:0,left:0,display:"flex",justifyContent:"center",alignItems:"center",width:"100%",height:"100%",overflow:"hidden",backgroundColor:"rgba(255, 255, 255, 0.6)",zIndex:9999})},{Item:ue}=t.B,me=()=>{const e=(0,u.j)(),o=(0,u.G)(_.Cq),i=(0,u.G)(j.GZ),t=(0,u.G)(j.Bk),l=(0,u.G)(L._8),a=(0,u.G)(I.Nz),s=(0,n.useRef)(null),[r,d]=(0,n.useState)(null),{t:c,i18n:p}=(0,v.Bd)();return(0,n.useEffect)((()=>{const o=JSON.parse((null===t||void 0===t?void 0:t.expand)||"[]").map((e=>!(0,k.UP)(e)||null!==e&&void 0!==e&&e.arrowHeadType?((0,k.Ll)(e)&&!e.data.label&&(e.data.label=e.data.name),e):Object.assign(e,{arrowHeadType:"arrow"})));e((0,_.VC)(o))}),[t]),(0,b.jsx)(ue,{shrink:!0,grow:1,className:pe.itemStyles,children:(0,b.jsxs)("div",{className:pe.flowWrapper,ref:s,children:[(0,b.jsxs)(k.Ay,{elements:o,nodeTypes:ce,snapToGrid:!0,snapGrid:[16,16],defaultZoom:1,onLoad:e=>{d(e)},onDrop:n=>{n.preventDefault();const t=s.current.getBoundingClientRect(),l=JSON.parse(n.dataTransfer.getData("application/reactflow")),a=r.project({x:n.clientX-t.left,y:n.clientY-t.top}),{args:d}=l,p={};if(Object.keys(d).reduce(((e,o)=>{const i={};return Object.keys(d[o]).reduce(((e,i)=>{const n=d[o][i].default;return Object.assign(e,{[i]:n}),e}),i),Object.assign(e,i),e}),p),i){e((0,I.GW)(!0));const n="".concat(l.name.replace(/\.|[\u4e00-\u9fa5]/g,"").replace(/_|\s/g,"-")||"task","-").concat(Date.now()).substring(0,49);C.A.task_modelview_add(i,{job_template:l.id,pipeline:+i,name:n,label:"".concat(c("\u65b0\u5efa")," ").concat(l.name," ").concat(c("\u4efb\u52a1")),volume_mount:"kubeflow-user-workspace(pvc):/mnt,kubeflow-archives(pvc):/archives",image_pull_policy:"Always",working_dir:"",command:"",overwrite_entrypoint:0,node_selector:"cpu=true,train=true",resource_memory:"2G",resource_cpu:"2",resource_gpu:"0",resource_rdma:"0",timeout:0,retry:0,args:JSON.stringify(p)}).then((i=>{var t;if(null!==i&&void 0!==i&&null!==(t=i.result)&&void 0!==t&&t.id){const t={id:"".concat(i.result.id),type:"dataSet",position:a,data:{info:l,name:n,label:"".concat(c("\u65b0\u5efa")," ").concat(l.name," ").concat(c("\u4efb\u52a1"))}};e((0,j.Eh)(!0)),e((0,_.VC)(o.concat(t))),setTimeout((()=>{e((0,j.cG)())}),2e3)}})).catch((o=>{o.response&&e((0,N.IV)({msg:o.response.data.message}))})).finally((()=>{e((0,I.GW)(!1))}))}},onDragOver:e=>{e.preventDefault(),e.dataTransfer.dropEffect="move"},onElementClick:(o,i)=>{l&&i.data&&e((0,L.L$)())},onElementsRemove:i=>{i.forEach((o=>{null!==o&&void 0!==o&&o.id&&(0,k.Ll)(o)&&C.A.task_modelview_del(+o.id).then((()=>{setTimeout((()=>{e((0,j.cG)())}),2e3)})).catch((o=>{o.response&&e((0,N.IV)({msg:o.response.data.message}))}))})),e((0,j.Eh)(!0)),e((0,_.VC)((0,k.g5)(i,o)))},onConnect:i=>{e((0,j.Eh)(!0)),e((0,_.VC)((0,k.rN)(Object.assign(i,{arrowHeadType:"arrow"}),o)))},onNodeDragStop:(i,n)=>{e((0,_.VC)(o.map((e=>(null===e||void 0===e?void 0:e.id)===(null===n||void 0===n?void 0:n.id)?n:e)))),e((0,j.Eh)(!0))},onSelectionChange:o=>{o&&e((0,_.JE)(o))},children:[(0,b.jsx)(z,{}),(0,b.jsx)(k.of,{nodeStrokeColor:"#8a8886",nodeColor:"#c8c8c8"}),(0,b.jsx)(k.H2,{}),(0,b.jsx)(y.U,{id:"hostId_model",className:"layer-host"})]}),(0,b.jsx)("div",{className:pe.spinnerWrapper,style:{visibility:a?"visible":"hidden"},children:(0,b.jsx)(w.y,{size:S.H.large,label:"Loading"})})]})})};var xe=i(94842);const he=()=>{const e=(0,u.j)(),o=(0,u.G)(N.Zw);return(0,n.useEffect)((()=>{o&&setTimeout((()=>{e((0,N.IV)(null))}),3e3)}),[o]),o&&(0,b.jsx)(s.n,{messageBarType:r.H.error,styles:{root:{minHeight:32,width:"80%",margin:"0 auto"}},dismissButtonAriaLabel:"Close",onDismiss:()=>{e((0,N.IV)(null))},isMultiline:!1,children:(null===o||void 0===o?void 0:o.msg)||""})},ge={headStyle:{root:{backgroundColor:"#fff",padding:"10px 16px",borderBottom:"1px solid #dadada"}},headNameStyle:(0,h.Zq)({boxSizing:"border-box",marginLeft:"8px",padding:"0 8px",height:"32px",lineHeight:"32px",cursor:"text",marginBottom:"4px",fontSize:"16px",fontWeight:600,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black"}),buttonItemStyle:{root:{marginRight:"16px"}},hidden:(0,h.Zq)({visibility:"hidden"})},{Item:ve}=t.B,be=()=>{const e=(0,u.j)(),o=(0,u.G)(j.GZ),i=(0,u.G)(j.Bk),n=(0,u.G)(N.lu),{t:a,i18n:s}=(0,v.Bd)();return(0,b.jsx)(ve,{className:"editor-head",children:(0,b.jsxs)(t.B,{horizontal:!0,horizontalAlign:"space-between",verticalAlign:"center",styles:ge.headStyle,children:[(0,b.jsx)(ve,{grow:1,children:(0,b.jsxs)(t.B,{horizontal:!0,children:[(0,b.jsx)(ve,{children:i.name?(0,b.jsx)("div",{className:ge.headNameStyle,children:i.describe}):(0,b.jsx)(d.j,{styles:{root:{padding:"17px 16px"}},iconProps:{iconName:"Add",styles:{root:{fontSize:10}}},onClick:()=>{C.A.pipeline_modelview_add({describe:"".concat(a("\u65b0\u5efa\u6d41\u6c34\u7ebf"),"-").concat(Date.now()),name:"".concat(n,"-pipeline-").concat(Date.now()),node_selector:"cpu=true,train=true",schedule_type:"once",image_pull_policy:"Always",parallelism:1,project:7}).then((e=>{var o;0===(null===e||void 0===e?void 0:e.status)&&"success"===(null===e||void 0===e?void 0:e.message)&&(window.location.search="?pipeline_id=".concat(null===e||void 0===e||null===(o=e.result)||void 0===o?void 0:o.id))})).catch((o=>{o.response&&e((0,N.IV)({msg:o.response.data.message}))}))},children:a("\u65b0\u5efa\u6d41\u6c34\u7ebf")})}),(0,b.jsx)(ve,{className:i.name?"":ge.hidden,children:(0,b.jsx)(xe.S,{content:a("\u8bbe\u7f6e"),children:(0,b.jsx)(l.K,{iconProps:{iconName:"Settings"},onClick:()=>{e((0,L.L$)())}})})}),(0,b.jsx)(ve,{grow:1,align:"center",children:(0,b.jsx)(he,{})})]})}),(0,b.jsx)(ve,{className:i.name?"":ge.hidden,children:(0,b.jsxs)(t.B,{horizontal:!0,children:[(0,b.jsx)(ve,{styles:ge.buttonItemStyle,children:(0,b.jsx)(d.j,{onClick:async()=>{o&&(await e(await(0,I.nf)()),e((0,j.cG)()),window.open("".concat(window.location.origin,"/pipeline_modelview/api/run_pipeline/").concat(o)))},children:a("\u8fd0\u884c")})}),(0,b.jsx)(ve,{styles:ge.buttonItemStyle,children:(0,b.jsx)(d.j,{onClick:async()=>{o&&window.open("".concat(window.location.origin,"/pipeline_modelview/api/copy_pipeline/").concat(o))},children:a("\u590d\u5236")})})]})})]})})};var fe=i(61944);const je={editorToolStyle:{root:{display:"flex",flexDirection:"row",backgroundColor:"#fff",padding:"2px 0px",borderBottom:"1px solid #dadada","#authoring-page-toolbar":{flex:1}}},autoSavedTips:(0,h.Zq)({paddingRight:20,lineHeight:"1"}),commandBarStyle:{root:{height:"40px",padding:"0px 14px 0px 8px",borderBottom:"none",backgroundColor:"#fff"}},commonButton:{root:{width:"40px",height:"40px",borderRadius:"2px",minWidth:"40px"}},commonIcon:{root:{color:"#015cda",fontSize:18}},toggleStyle:{root:{display:"flex",alignItems:"center",padding:"8px 0px 8px 8px",height:"100%",boxSizing:"border-box",borderLeft:"1px solid rgb(234, 234, 234)",marginLeft:"8px"},container:{display:"inline-flex"}},comboBoxStyle:{container:{borderLeft:"1px solid #eaeaea",marginLeft:"4px",padding:"0px 5px 0px 10px",width:"auto"},root:{backgroundColor:"#ffffff",padding:"0px 20px 0px 4px",selectors:{"&.is-open::after":{borderBottom:"2px solid #015cda"},"&::after":{border:"none",borderBottom:0,borderRadius:"none"},".ms-Button":{width:20},".ms-Icon":{fontSize:8}}},input:{width:35,backgroundColor:"#ffffff"}}},{Item:ye}=t.B,we=()=>{const e=(0,u.j)(),o=(0,u.G)(_.Cq),i=(0,u.G)(j.cd),l=(0,u.G)(j.Bk),s=(0,u.G)(j.GZ),r=(0,u.G)(I.mm),d=(0,u.G)(j.$O),c=(0,u.G)(_.QF),{t:p,i18n:m}=(0,v.Bd)(),x=[{key:"expand",iconProps:{iconName:"Library",styles:je.commonIcon},text:p("\u5c55\u5f00/\u5173\u95ed\u83dc\u5355"),onClick:o=>{null===o||void 0===o||o.preventDefault(),e((0,fe.L$)())}},{key:"save",iconProps:{iconName:"save",styles:je.commonIcon},text:p("\u4fdd\u5b58"),onClick:async o=>{null===o||void 0===o||o.preventDefault(),e(await(0,I.nf)()),e((0,j.cG)())}},{key:"example",iconProps:{iconName:"FastForward",styles:je.commonIcon},text:p("\u8c03\u5ea6\u5b9e\u4f8b"),onClick:()=>{s&&window.open("".concat(window.location.origin,"/pipeline_modelview/api/web/workflow/").concat(s))}},{key:"log",iconProps:{iconName:"ComplianceAudit",styles:je.commonIcon},text:p("\u65e5\u5fd7"),onClick:()=>{null!==l&&void 0!==l&&l.id&&window.open("".concat(window.location.origin,"/pipeline_modelview/api/web/log/").concat(s))}},{key:"docker",iconProps:{iconName:"WebAppBuilderFragment",styles:je.commonIcon},text:p("\u5bb9\u5668"),onClick:()=>{null!==l&&void 0!==l&&l.name&&window.open("".concat(window.location.origin,"/pipeline_modelview/api/web/pod/").concat(s))}},{key:"timer",iconProps:{iconName:"TimeEntry",styles:je.commonIcon},text:p("\u5b9a\u65f6\u8bb0\u5f55"),onClick:()=>{null!==l&&void 0!==l&&l.name&&window.open("".concat(window.location.origin,"/pipeline_modelview/api/web/runhistory/").concat(s))}},{key:"delete",iconProps:{iconName:"Delete",styles:je.commonIcon},text:p("\u5220\u9664\u8282\u70b9"),onClick:()=>{if((0,k.Ll)(c[0])){var i;const o=+(null===(i=c[0])||void 0===i?void 0:i.id);C.A.task_modelview_del(o).then((()=>{setTimeout((()=>{e((0,j.cG)())}),2e3)})).catch((o=>{o.response&&e((0,N.IV)({msg:o.response.data.message}))}))}e((0,j.Eh)(!0)),e((0,_.VC)((0,k.g5)(c,o)))}},{key:"monitor",iconProps:{iconName:"NetworkTower",styles:je.commonIcon},text:p("\u76d1\u63a7"),onClick:()=>{null!==l&&void 0!==l&&l.id&&window.open("".concat(window.location.origin,"/pipeline_modelview/api/web/monitoring/").concat(s))}}];return(0,n.useEffect)((()=>{r&&r.forEach((o=>{Object.keys(o).length>0&&e((0,j.Eh)(!0))}))}),[r]),(0,b.jsxs)(ye,{shrink:!0,styles:je.editorToolStyle,children:[(0,b.jsx)(H.r,{id:"authoring-page-toolbar",styles:je.commandBarStyle,items:x}),(0,b.jsx)(t.B,{horizontal:!0,verticalAlign:"center",className:je.autoSavedTips,style:{visibility:s?"visible":"hidden"},children:i?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(a.I,{iconName:d?"AlertSolid":"SkypeCircleCheck",styles:{root:{color:d?"#e95f39":"#8cb93c",marginRight:5}}}),p(d?"\u672a\u4fdd\u5b58":"\u5df2\u4fdd\u5b58")]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.y,{styles:{root:{marginRight:5}},size:S.H.small}),p("\u4fdd\u5b58\u4e2d")]})})]})},{Item:Se}=t.B,ke=()=>{const e=(0,u.j)();return(0,n.useEffect)((()=>{e((0,j.B0)())}),[]),(0,b.jsx)(Se,{className:"flow-editor",styles:{root:{flexGrow:1,flexShrink:1,background:"#f4f4f4",overflow:"hidden",display:"flex",flexDirection:"column"}},children:(0,b.jsxs)(t.B,{grow:1,children:[(0,b.jsx)(be,{}),(0,b.jsx)(we,{}),(0,b.jsx)(me,{})]})})};var Ce=i(54555),Ne=i(50840),_e=i(10615),Le=i(65337);const Ie={calloutContent:(0,h.Zq)({display:"flex",flexFlow:"column nowrap",width:"360px",height:"auto",boxSizing:"border-box",maxHeight:"inherit",padding:"16px 0px",fontSize:"12px",background:"#fff",borderRadius:"2px"}),moduleDetailItemStyle:(0,h.Zq)({fontSize:"12px",padding:"0 16px",overflowX:"visible",overflowY:"hidden"}),moduleDetailTitle:(0,h.Zq)({padding:"0px 16px",fontWeight:600,fontSize:"14px",lineHeight:"1",marginTop:"0px",marginBottom:"8px"}),moduleDetailLabel:(0,h.Zq)({fontSize:"12px",fontWeight:"bold",lineHeight:"16px",color:"rgb(89, 89, 89)",padding:"0px",margin:"0px 0px 4px"}),moduleDetailBody:(0,h.Zq)({lineHeight:"14px",marginBottom:"22px",p:{margin:"0",padding:"0"}}),moduleButton:(0,h.Zq)({display:"flex",justifyContent:"center",alignItems:"center"})},{Item:Be}=t.B,qe=()=>{var e;const o=(0,u.j)(),i=(0,u.G)(fe.n_),n=(0,u.G)(fe.Y2),l=(0,u.G)(fe.Bk),{t:a,i18n:s}=(0,v.Bd)(),r=e=>{o((0,fe.M7)("mouseenter"!==e.type))};return(0,b.jsx)(Ne.P,{gapSpace:-10,hidden:i,hideOverflow:!0,calloutMaxHeight:480,isBeakVisible:!1,preventDismissOnLostFocus:!0,target:{current:n},directionalHint:12,children:(0,b.jsxs)(t.B,{className:Ie.calloutContent,onMouseEnter:r,onMouseLeave:r,children:[(0,b.jsx)(Be,{children:(0,b.jsx)("h3",{className:Ie.moduleDetailTitle,children:l.name})}),(0,b.jsx)(Be,{grow:1,shrink:1,className:Ie.moduleDetailItemStyle,children:(0,b.jsxs)("div",{children:[(0,b.jsx)(M.J,{title:"Description",className:Ie.moduleDetailLabel,children:a("\u63cf\u8ff0")}),(0,b.jsx)("div",{className:Ie.moduleDetailBody,children:(0,b.jsx)("p",{children:l.describe})})]})}),(0,b.jsx)(Be,{grow:1,shrink:1,className:Ie.moduleDetailItemStyle,children:(0,b.jsxs)("div",{children:[(0,b.jsx)(M.J,{title:"Description",className:Ie.moduleDetailLabel,children:a("\u521b\u5efa\u4eba")}),(0,b.jsx)("div",{className:Ie.moduleDetailBody,children:(0,b.jsx)("p",{children:l.createdBy})})]})}),(0,b.jsx)(Be,{grow:1,shrink:1,className:Ie.moduleDetailItemStyle,children:(0,b.jsxs)("div",{children:[(0,b.jsx)(M.J,{title:"Description",className:Ie.moduleDetailLabel,children:a("\u955c\u50cf")}),(0,b.jsx)("div",{className:Ie.moduleDetailBody,children:(0,b.jsx)("p",{children:l.imagesName})})]})}),(0,b.jsx)(Be,{grow:1,shrink:1,className:Ie.moduleDetailItemStyle,children:(0,b.jsxs)("div",{children:[(0,b.jsx)(M.J,{title:"Description",className:Ie.moduleDetailLabel,children:a("\u4e0a\u6b21\u4fee\u6539\u65f6\u95f4")}),(0,b.jsx)("div",{className:Ie.moduleDetailBody,children:(0,b.jsx)("p",{children:l.lastChanged})})]})}),(0,b.jsx)(Be,{grow:1,shrink:1,className:Ie.moduleDetailItemStyle,children:(0,b.jsxs)("div",{children:[(0,b.jsx)(M.J,{title:"Description",className:Ie.moduleDetailLabel,children:a("\u7248\u672c")}),(0,b.jsx)("div",{className:Ie.moduleDetailBody,children:(0,b.jsx)("p",{children:l.version})})]})}),null!==l&&void 0!==l&&null!==(e=l.expand)&&void 0!==e&&e.help_url?(0,b.jsx)(Be,{grow:1,shrink:1,className:Ie.moduleButton,children:(0,b.jsx)(d.j,{onClick:()=>{window.open(l.expand.help_url)},children:a("\u914d\u7f6e\u6587\u6863")})}):null]})})},De={moduleItem:(0,h.Zq)({width:"100%",userSelect:"none",cursor:"pointer"}),moduleListModuleCard:(0,h.Zq)({margin:"8px 16px",border:"1px solid rgb(234, 234, 234)",background:"rgb(248, 248, 248)",color:"rgb(55, 55, 55)",borderRadius:"2px",padding:"8px",display:"flex",fontSize:"12px",flexDirection:"column","&:hover":{backgroundColor:"#eee"},"> div":{pointerEvents:"none",display:"flex",flexDirection:"row",flexGrow:1,alignItems:"center","> header":{flexGrow:1,color:"rgb(0, 0, 0)",fontWeight:600,fontSize:"12px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",lineHeight:"16px"},"> summary":{flexGrow:1,color:"rgb(55, 55, 55)",fontSize:"12px"}}})},Ze=e=>{const o=(0,u.j)(),[i,t]=(0,n.useState)(e.model),l=e=>{"mouseenter"===e.type&&o((0,fe.fL)(e.target)),o((0,fe.M7)("mouseenter"!==e.type)),o((0,fe.CI)(i))};return(0,n.useEffect)((()=>{t(e.model)}),[e.model]),(0,b.jsx)("div",{className:De.moduleItem,children:(0,b.jsx)("div",{className:"module-card-with-hover-wrap",children:(0,b.jsx)("div",{className:"module-card-content-wrap",children:(0,b.jsxs)("div",{className:De.moduleListModuleCard,onMouseEnter:l,onMouseLeave:l,onMouseDown:()=>{o((0,fe.M7)(!0))},onDragStart:e=>{e.dataTransfer.setData("application/reactflow",JSON.stringify(i)),e.dataTransfer.effectAllowed="move"},draggable:!0,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(a.I,{iconName:"Database",styles:{root:{marginRight:"4px",lineHeight:"16px"}}}),(0,b.jsx)("header",{children:i.name})]}),(0,b.jsx)("div",{children:(0,b.jsx)("summary",{children:(0,b.jsx)("span",{children:i.describe})})})]})})})})},Ge={moduleItem:(0,h.Zq)({width:"100%",userSelect:"none",cursor:"pointer"}),moduleListModuleCard:(0,h.Zq)({margin:"4px 8px",border:"1px solid rgb(234, 234, 234)",background:"rgb(248, 248, 248)",color:"rgb(55, 55, 55)",borderRadius:"2px",padding:"5px 8px",display:"flex",fontSize:"12px",flexDirection:"column","&:hover":{backgroundColor:"#eee"},"> div":{pointerEvents:"none",display:"flex",flexDirection:"row",flexGrow:1,alignItems:"center","> header":{flexGrow:1,color:"rgb(0, 0, 0)",fontWeight:600,fontSize:"12px",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap",lineHeight:"16px"},"> summary":{flexGrow:1,color:"rgb(55, 55, 55)",fontSize:"12px"}}})},Oe=e=>{const[o,i]=(0,n.useState)(e.model);return(0,n.useEffect)((()=>{i(e.model)}),[e.model]),(0,b.jsx)("div",{className:Ge.moduleItem,children:(0,b.jsx)("div",{className:"module-card-with-hover-wrap",children:(0,b.jsx)("div",{className:"module-card-content-wrap",children:(0,b.jsxs)("div",{className:Ge.moduleListModuleCard,onClick:e.onClick,children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(a.I,{iconName:"Database",styles:{root:{marginRight:"4px",lineHeight:"16px"}}}),(0,b.jsx)("header",{children:o.name})]}),(0,b.jsx)("div",{children:(0,b.jsx)("summary",{children:(0,b.jsx)("span",{children:o.describe})})})]})})})})},Te={"::-webkit-scrollbar":{width:4},"::-webkit-scrollbar-thumb":{minHeight:"15px",border:"6px solid transparent",backgroundClip:"padding-box",backgroundColor:"rgb(200, 200, 200)"}},Ae={showModuleTree:(0,h.Zq)({width:"320px",height:"100%",transition:"all 0.35s ease 0s",overflowX:"hidden",visibility:"visible"}),hideModuleTree:(0,h.Zq)({width:"0px",height:"100%",transition:"width 0.35s ease 0s",overflowX:"hidden",visibility:"hidden"}),treeContainer:(0,h.Zq)({width:"320px",boxSizing:"border-box",height:"100%",display:"flex",flexDirection:"column",borderRight:"1px solid rgb(234, 234, 234)",backgroundColor:"#fff"}),searchBoxStyle:(0,h.Zq)({margin:"12px 16px",padding:"1px 0px",color:"rgb(1, 92, 218)",lineHeight:"32px",minHeight:"32px",flexGrow:"1"}),searchCallout:(0,h.Zq)({".ms-Callout-main":{overflowY:"overlay",willChange:"transform",...Te}}),searchListStyle:(0,h.Zq)({width:"287px",padding:"8px 0"}),summaryStyle:(0,h.Zq)({display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 16px",borderTop:"1px solid rgb(218, 218, 218)"}),moduleTreeStyle:(0,h.Zq)({position:"relative",display:"flex",flexDirection:"column",overflowX:"hidden",overflowY:"auto",flexGrow:"1"}),moduleTreeBody:(0,h.Zq)({position:"relative",height:"100%"}),listIconStyle:(0,h.Zq)({display:"inline-flex",fontSize:"12px",lineHeight:"12px",marginRight:"4px",height:"6px",color:"rgb(55, 55, 55)",userSelect:"none"}),spinnerContainer:(0,h.Zq)({width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),moduleListStyle:(0,h.Zq)({padding:0,margin:"0 auto",overflowY:"overlay",height:"100%",willChange:"transform",...Te}),moduleListItem:(0,h.Zq)({listStyle:"none",outline:"none"}),itemFolderNode:(0,h.Zq)({display:"flex",alignItems:"center",cursor:"pointer",padding:"7px 15px",border:"1px solid transparent",fontFamily:"Segoe UI,sans-serif",fontSize:12,lineHeight:16,fontWeight:600,color:"black","&:hover":{backgroundColor:"#eaeaea"}})},{Item:ze}=t.B,Ee=[{color:"rgba(0,120,212,1)",bg:"rgba(0,120,212,0.02)"},{color:"rgba(0,170,200,1)",bg:"rgba(0,170,200,0.02)"},{color:"rgba(0,200,153,1)",bg:"rgba(0,200,153,0.02)"},{color:"rgba(0,6,200,1)",bg:"rgba(0,6,200,0.02)"},{color:"rgba(212,65,0,1)",bg:"rgba(212,65,0,0.02)"},{color:"rgba(212,176,0,1)",bg:"rgba(212,176,0,0.02)"}],He=()=>{const e=(0,u.j)(),o=(0,u.G)(fe._8),[i,s]=(0,n.useState)(new Set),[r,d]=(0,n.useState)(new Map),[c,p]=(0,n.useState)(0),[m,h]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),[j,y]=(0,n.useState)(new Map),{t:k,i18n:_}=(0,v.Bd)(),L=e=>{const o=new Map;let i=0;e.forEach((e=>{if("Release"!==e.version)return;i+=1;const n={id:e.id,args:e.args?JSON.parse(e.args):{},name:e.name,version:e.version,describe:e.describe,imagesName:e.images.name,createdBy:e.created_by.username,lastChanged:e.changed_on,expand:JSON.parse(e.expand),color:Ee[e.project.id%Ee.length]};o.has(e.project.id)?o.get(e.project.id).children.push(n):o.set(e.project.id,{id:e.project.id,title:e.project.name,children:[n]})})),p(i),d(o)},I=()=>{h(!0),p(0),C.A.job_template_modelview().then((e=>{if(0===(null===e||void 0===e?void 0:e.status)&&"success"===(null===e||void 0===e?void 0:e.message)){L(null===e||void 0===e?void 0:e.result.data);const o=Date.now();de.set("job_template",{update:o,value:null===e||void 0===e?void 0:e.result.data,expire:864e5})}})).catch((o=>{var i,n;o.response&&e((0,N.IV)({msg:null===(i=o.response)||void 0===i||null===(n=i.data)||void 0===n?void 0:n.message}))})).finally((()=>{h(!1)}))};return(0,n.useEffect)((()=>{const e=de.get("job_template");e&&Date.now()-(null===e||void 0===e?void 0:e.update)<(null===e||void 0===e?void 0:e.expire)?L(e.value):I()}),[]),(0,b.jsxs)(ze,{shrink:!0,children:[(0,b.jsx)("div",{className:o?Ae.showModuleTree:Ae.hideModuleTree,children:(0,b.jsxs)("div",{className:Ae.treeContainer,children:[(0,b.jsxs)(t.B,{horizontal:!0,horizontalAlign:"space-between",children:[(0,b.jsx)(Ce.G,{placeholder:k("\u641c\u7d22\u6a21\u677f\u540d\u79f0\u6216\u63cf\u8ff0"),role:"search",className:Ae.searchBoxStyle,onChange:x(((e,o)=>{if(!o)return void f(!1);console.log(o);const i=new Map;r.forEach(((e,n)=>{const{children:t}=e;t.length>0&&t.forEach((e=>{var t,l;((null===e||void 0===e||null===(t=e.name)||void 0===t?void 0:t.indexOf(o))>-1||(null===e||void 0===e||null===(l=e.describe)||void 0===l?void 0:l.indexOf(o))>-1)&&(i.has(n)?i.set(n,i.get(n).concat(e)):i.set(n,[e]))}))})),y(i),f(!0)}),300),onBlur:()=>{setTimeout((()=>{f(!1)}),300)}}),(0,b.jsx)(Ne.P,{className:Ae.searchCallout,isBeakVisible:!1,preventDismissOnLostFocus:!0,hidden:!g,calloutMaxHeight:300,target:".ms-SearchBox",children:(0,b.jsxs)(t.B,{className:Ae.searchListStyle,children:[0===Array.from(j.keys()).length?(0,b.jsx)("div",{style:{textAlign:"center"},children:k("\u6682\u65e0\u5339\u914d")}):"",Array.from(j.keys()).map((e=>{const o=j.get(e);return(0,b.jsx)(n.Fragment,{children:null===o||void 0===o?void 0:o.map((o=>(0,b.jsx)(Oe,{model:o,onClick:()=>{console.log(i),i.has(e)||(i.add(e),s(new Set(i)))}},o.id)))},e)}))]})})]}),(0,b.jsxs)("div",{className:Ae.summaryStyle,children:[(0,b.jsxs)(_e.E,{children:[c," assets in total"]}),(0,b.jsx)(Le.R,{children:(0,b.jsx)(l.K,{iconProps:{iconName:"Refresh"},onClick:()=>{m||I()}})})]}),(0,b.jsx)("div",{className:Ae.moduleTreeStyle,children:(0,b.jsx)("div",{className:Ae.moduleTreeBody,children:m?(0,b.jsx)(t.B,{className:Ae.spinnerContainer,children:(0,b.jsx)(w.y,{size:S.H.large,label:"Loading"})}):(0,b.jsx)("ul",{className:Ae.moduleListStyle,children:Array.from(r.keys()).map((e=>{var o;const n=r.get(e);return(0,b.jsxs)("li",{className:Ae.moduleListItem,children:[(0,b.jsx)("div",{role:"button",onClick:()=>{i.has(e)?i.delete(e):i.add(e),s(new Set(i))},children:(0,b.jsxs)("div",{className:Ae.itemFolderNode,children:[(0,b.jsx)(a.I,{iconName:i.has(e)?"FlickUp":"FlickLeft",styles:{root:{alignItems:i.has(e)?"baseline":"center"}},className:Ae.listIconStyle}),n.title]})}),i.has(e)?(0,b.jsx)("ul",{role:"group",style:{paddingLeft:"0px"},children:null===(o=n.children)||void 0===o?void 0:o.map((e=>(0,b.jsx)("li",{className:Ae.moduleListItem,children:(0,b.jsx)("div",{role:"button",children:(0,b.jsx)(Ze,{model:e})})},e.id)))}):null]},e)}))})})})]})}),(0,b.jsx)(qe,{})]})},We={root:{width:"100%",height:"100%",overflow:"hidden"}},Me=()=>(0,b.jsxs)(t.B,{className:"app-container",horizontal:!0,styles:We,children:[(0,b.jsx)(He,{}),(0,b.jsx)(ke,{}),(0,b.jsx)(f,{})]})}}]);