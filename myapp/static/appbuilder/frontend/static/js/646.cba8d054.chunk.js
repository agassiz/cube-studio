"use strict";(self.webpackChunkkubeflow_frontend=self.webpackChunkkubeflow_frontend||[]).push([[646],{68062:(e,t,n)=>{n.d(t,{A:()=>c});var s=n(62863),a=n(8315),l=n(76998),r=n(23446);function c(e){const t=Math.random().toString(36).substring(2);let n;const[c,o]=(0,l.useState)(e.options||[]),[i,d]=(0,l.useState)(e.value||"");(0,l.useEffect)((()=>{const t=e.isOpenSearchMatch?(e.options||[]).filter((e=>-1!==e.indexOf(i))):e.options||[];o(t)}),[e.options]),(0,l.useEffect)((()=>{d(e.value||"")}),[e.value]);const u=t=>{d(t),e.onChange&&e.onChange(t)},h=e=>{const t=i,n=e.indexOf(i);if(-1===n)return(0,r.jsx)("span",{children:e});const s=e.substring(0,n),a=e.substring(n+i.length);return(0,r.jsxs)("span",{children:[s,(0,r.jsx)("span",{className:"highlight",children:t}),a]})},m=function(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;return function(){for(var s=arguments.length,a=new Array(s),l=0;l<s;l++)a[l]=arguments[l];clearTimeout(t),t=setTimeout((()=>{e&&e.apply(null,[...a])}),n)}}(e.onScrollButtom);return(0,r.jsxs)("div",{className:"select-down-modern",children:[e.labelName?(0,r.jsx)("label",{htmlFor:t,className:"pb4 mb0 fs12 d-b",children:e.labelName}):null,(0,r.jsxs)("div",{className:"p-r d-f ac",style:{width:e.width||"100%"},children:[(0,r.jsx)(a.A,{style:{width:"100%"},disabled:e.disabled,id:t,placeholder:e.placeholder||"",maxLength:e.maxLength||200,onChange:e=>u(e.target.value),onKeyPress:t=>{13===t.nativeEvent.keyCode&&(n.blur&&n.blur(),e.onSearch&&e.onSearch(t.currentTarget.value))},value:i,ref:e=>n=e}),(0,r.jsx)(s.A,{className:"p-a r0 mr8"})]}),c.length?(0,r.jsxs)("ul",{className:"select-option shadow",onScroll:t=>{t.stopPropagation();const{currentTarget:n}=t,{scrollTop:s,clientHeight:a,scrollHeight:l}=n;l-a-s<20&&e.onScrollButtom&&m()},style:{maxHeight:"".concat(e.maxHeight,"px")},children:[e.loading?(0,r.jsx)("div",{className:"p-s z9 ta-r",style:{right:"".concat(0,"px"),top:"".concat(0,"px")},children:(0,r.jsx)("div",{className:"d-il p-a",style:{right:"".concat(8,"px"),top:"".concat(0,"px")}})}):null,c.map(((t,n)=>(0,r.jsx)("li",{className:"ellip1",onMouseDown:()=>(t=>{u(t),e.onClick&&e.onClick(t)})(t),children:h(t)},n)))]}):null]})}},64515:(e,t,n)=>{n.d(t,{A:()=>v});var s=n(76998),a=n(7518),l=n(80281),r=n(4283),c=n(95381),o=n(65506),i=n(60498),d=n(93858),u=n(9788),h=n(38697),m=n(70011);const p=n.p+"static/media/emptyBg.15fdf5f39309784ac66e.png";var x=n(91838),g=n(77678),f=n(23446);const j=n(65309),A=e=>{let{onResize:t,width:n,...s}=e;return n?(0,f.jsx)(x.Resizable,{width:n,height:0,handle:(0,f.jsx)("span",{className:"react-resizable-handle",onClick:e=>{e.stopPropagation()}}),onResize:t,draggableOpts:{enableUserSelectHack:!1},children:(0,f.jsx)("th",{...s,style:{...null===s||void 0===s?void 0:s.style,userSelect:"none"}})}):(0,f.jsx)("th",{...s})},v=e=>{const[t,n]=(0,s.useState)(!1),[x,v]=(0,s.useState)({header:[],data:[]}),[b,N]=(0,s.useState)([]),[S,y]=(0,s.useState)(e.columns),k=t=>(n,s)=>{let{size:a}=s;if(a.width<100)return;const l=[...S];l[t]={...l[t],width:a.width};const r=l.reduce(((e,t)=>e+t.width||100),0)+200;localStorage.setItem(e.tableKey||"",JSON.stringify(l)),I({...E,x:r}),y(l)},C=S.map(((e,t)=>({...e,width:e.width||200,onHeaderCell:e=>({width:e.width,onResize:k(t)})}))),[E,I]=(0,s.useState)(e.scroll),{t:w,i18n:T}=(0,g.Bd)();(0,s.useEffect)((()=>{y(e.columns)}),[e.columns]),(0,s.useEffect)((()=>{I(e.scroll)}),[e.scroll]),(0,s.useEffect)((()=>{if(e.dataSource){const t=e.columns.filter((e=>~b.indexOf(e.dataIndex)));O(t,e.dataSource)}}),[e.dataSource,e.columns]);const O=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=e.map((e=>e.dataIndex)).filter((e=>"handle"!==e)),s=e.map((e=>e.title)).filter((e=>e!==w("\u64cd\u4f5c"))),a=[];t.forEach((e=>{const t={};n.map((n=>{const s=e[n];t[n]=s||""})),a.push(t)})),v({header:s,data:a})},R=()=>{const e=x.header,t=x.data;let n="";return e.length&&t.length?(n="|"+e.join("|")+"|\n",t.forEach((e=>{const t=Object.values(e).map((e=>""===e?" ":e));n=n+"|"+t.join("|")+"|\n"}))):n="",n},P=()=>{const e=x.header,t=x.data;let n="";return e.length&&t.length?(n=e.join("\t")+"\n",t.forEach((e=>{const t=Object.values(e).map((e=>""===e?" ":e));n=n+t.join("\t")+"\n"}))):n="",n};return(0,f.jsxs)(l.A,{className:"tablebox",direction:"vertical",size:"middle",children:[(0,f.jsxs)(r.A,{width:1e3,maskClosable:!1,centered:!0,bodyStyle:{maxHeight:500,overflow:"auto"},visible:t,title:w("\u5bfc\u51fa\u6570\u636e"),onCancel:()=>{n(!1)},footer:null,children:[(0,f.jsxs)("div",{style:{position:"relative"},children:[(0,f.jsxs)("div",{className:"mb16",children:[(0,f.jsxs)("span",{className:"pr8",children:[w("\u9009\u62e9\u9700\u8981\u5bfc\u51fa\u7684\u5217"),"\uff1a"]}),(0,f.jsx)(c.A.Group,{options:e.columns.map((e=>({label:e.title,value:e.dataIndex}))).filter((e=>"handle"!==e.value)),defaultValue:[],value:b,onChange:t=>{N(t);const n=e.columns.filter((e=>~t.indexOf(e.dataIndex)));O(n,e.dataSource)}})]}),(0,f.jsxs)("div",{style:{position:"absolute",right:0,bottom:0},children:[(0,f.jsx)(o.A,{size:"small",type:"link",onClick:()=>{N(e.columns.map((e=>e.dataIndex)).filter((e=>"handle"!==e))),O(e.columns,e.dataSource)},children:w("\u5168\u9009")}),(0,f.jsx)(o.A,{size:"small",type:"link",onClick:()=>{N([]),O([],e.dataSource)},children:w("\u53cd\u9009")})]})]}),(0,f.jsxs)(i.A,{children:[(0,f.jsx)(i.A.TabPane,{tab:"Wiki\u683c\u5f0f",children:(0,f.jsx)(j,{text:R(),onCopy:()=>d.Ay.success(w("\u5df2\u590d\u5236\u5230\u7c98\u8d34\u677f")),children:(0,f.jsx)("pre",{style:{cursor:"pointer",minHeight:100},children:(0,f.jsx)("code",{children:R()})})})},"jira"),(0,f.jsx)(i.A.TabPane,{tab:"Text\u683c\u5f0f",children:(0,f.jsx)(j,{text:P(),onCopy:()=>d.Ay.success(w("\u5df2\u590d\u5236\u5230\u7c98\u8d34\u677f")),children:(0,f.jsx)("pre",{style:{cursor:"pointer",minHeight:100},children:(0,f.jsx)("code",{children:P()})})})},"test")]})]}),e.titleNode||e.buttonNode||!e.cancelExportData?(0,f.jsxs)(a.A,{justify:"space-between",align:"middle",children:[(0,f.jsx)(u.A,{children:(0,f.jsx)(l.A,{align:"center",children:e.titleNode})}),(0,f.jsx)(u.A,{children:(0,f.jsxs)(l.A,{align:"center",children:[e.buttonNode,e.cancelExportData?null:(0,f.jsx)(o.A,{style:{marginLeft:6},onClick:()=>n(!0),children:w("\u5bfc\u51fa\u6570\u636e")})]})})]}):null,(0,f.jsx)(h.Ay,{renderEmpty:()=>(0,f.jsxs)(a.A,{justify:"center",align:"middle",style:{height:360,flexDirection:"column"},children:[(0,f.jsx)("img",{src:p,style:{width:266},alt:""}),(0,f.jsx)("div",{children:w("\u6682\u65e0\u6570\u636e")})]}),children:(0,f.jsx)(m.A,{size:e.size||"middle",rowKey:e.rowKey?e.rowKey:"id",dataSource:e.dataSource,components:{header:{cell:A}},columns:C,pagination:!1!==e.pagination&&{...e.pagination},scroll:E,loading:e.loading,onChange:e.onChange,rowSelection:e.rowSelection})})]})}},53952:(e,t,n)=>{n.r(t),n.d(t,{default:()=>te});var s=n(22424),a=n(53592),l=n(93775),r=n(93858),c=n(4283),o=n(60498),i=n(4520),d=n(65506),u=n(76998),h=n(50706);const m=e=>h.A.post("/idex/submit_task",e),p=e=>h.A.get("/idex/look/".concat(e)),x=(e,t)=>h.A.get("/idex/download_url/".concat(e),{params:{separator:t}}),g=e=>h.A.get("/idex/result/".concat(e)),f=e=>h.A.get("/idex/stop/".concat(e)),j=()=>h.A.get("/idex/config");var A=n(55951),v=n(58818),b=n(37010),N=n(76109),S=n(23446);function y(e){return(0,S.jsx)(S.Fragment,{children:(0,S.jsx)(A.Ay,{theme:v.di,value:e.value,onChange:e.onChange,extensions:[(0,N.ll)(),(0,b.T)({step:2,lightColor:"#fafafa",darkColor:"#fafafa"})]})})}var k=n(68062),C=n(77892),E=n.n(C),I=n(2381),w=n(91353),T=n(71155),O=n(97041),R=n(83662),P=n(73035),M=n(18e3),D=n(94509),L=n(71087),H=n(97789),F=n(7518),U=n(9788),B=n(64515),_=n(77678);const z={start:0,parse:1,execute:2,end:3},V=e=>{switch(e){case"init":case"running":return(0,S.jsx)(I.A,{});case"failure":return(0,S.jsx)(w.A,{style:{color:"#ff4444"}});case"stop":return(0,S.jsx)(T.A,{});default:return null}};function Y(e){const{t:t,i18n:n}=(0,_.Bd)(),[s,a]=(0,u.useState)(!1),[l,o]=(0,u.useState)(!1),[i,h]=(0,u.useState)(!0),[m,p]=(0,u.useState)("|"),j=(0,u.useRef)(m),A=e=>{j.current=e,p(e)},[v,b]=(0,u.useState)("|"),N=(0,u.useRef)(v),y=e=>{const t=e[0]||[],n=e.slice(1).map((e=>e.reduce(((e,n,s)=>({...e,[t[s]]:n})),{})));return{config:t.map((e=>({title:e,dataIndex:e,key:e,width:120}))),data:n}};return(0,S.jsxs)("div",{children:[(0,S.jsx)(c.A,{title:t("\u7ed3\u679c"),visible:s,footer:null,destroyOnClose:!0,onCancel:()=>{A("|"),a(!1)},children:(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{className:"d-f ac pt8",children:[(0,S.jsxs)("div",{className:"w96",children:[t("\u9009\u62e9\u5206\u9694\u7b26"),"\uff1a"]}),(0,S.jsx)(M.A,{style:{width:256},value:j.current,options:[{label:"|",value:"|"},{label:",",value:","},{label:"TAB",value:"TAB"}],onChange:e=>{A(e)}})]}),(0,S.jsx)("div",{className:"ta-r pt16",children:(0,S.jsx)(d.A,{type:"primary",onClick:()=>{x(N.current,j.current).then((e=>{window.open(e.data.download_url,"bank")})).catch((e=>{console.log(e)}))},children:t("\u4e0b\u8f7d")})})]})}),(0,S.jsx)(D.A,{className:"site-collapse-custom-collapse",defaultActiveKey:["task_0"],onChange:e=>{console.log(e)},children:(Object.entries(e.option).reduce(((e,t)=>{let[n,s]=t;return[...e,s]}),[])||[]).reverse().filter((e=>!!e.reqId)).map(((n,s)=>(0,S.jsxs)(D.A.Panel,{className:["site-collapse-custom-panel","status-".concat(n.status)].join(" "),header:"".concat(t("\u5b50\u4efb\u52a1")).concat(n.reqId),extra:(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(d.A,{className:"mr16",type:"default",size:"small",onClick:t=>{t.stopPropagation(),e.onDelete(n.reqId)},children:[t("\u5220\u9664"),(0,S.jsx)(O.A,{})]}),(0,S.jsxs)(d.A,{type:"primary",size:"small",onClick:t=>{t.stopPropagation(),e.onRetry(n.reqId)},children:[t("\u91cd\u8bd5"),(0,S.jsx)(R.A,{})]})]}),children:[(0,S.jsxs)(L.A,{size:"small",current:z[n.step],children:[(0,S.jsx)(L.A.Step,{title:t("\u51c6\u5907\u5f00\u59cb"),icon:0===z[n.step]?V(n.status):null}),(0,S.jsx)(L.A.Step,{title:t("\u89e3\u6790"),icon:1===z[n.step]?V(n.status):null}),(0,S.jsx)(L.A.Step,{title:t("\u6267\u884c"),icon:2===z[n.step]?V(n.status):null}),(0,S.jsx)(L.A.Step,{title:t("\u8f93\u51fa\u7ed3\u679c"),icon:3===z[n.step]?V(n.status):null})]}),(0,S.jsx)(B.A,{size:"small",loading:!1,cancelExportData:!0,rowKey:e=>JSON.stringify(e),columns:[{title:t("\u5b50\u4efb\u52a1"),dataIndex:"content",key:"content",render:e=>(0,S.jsx)(H.A,{placement:"top",title:e,children:(0,S.jsx)("div",{className:"ellip1 w256",children:e})})},{title:t("\u5f00\u59cb\u65f6\u95f4"),dataIndex:"startime",key:"startime"},{title:t("\u8fd0\u884c\u65f6\u957f"),dataIndex:"duration",key:"duration"},{title:t("\u72b6\u6001"),dataIndex:"status",key:"status",render:e=>(0,S.jsx)("span",{className:["c-".concat(n.status)].join(" "),children:e})},{title:t("\u64cd\u4f5c"),dataIndex:"action",key:"action",render:()=>(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("span",{className:"link mr16",onClick:()=>{c.A.info({title:t("\u4efb\u52a1\u8be6\u60c5"),width:600,okText:t("\u5173\u95ed"),content:(0,S.jsxs)("div",{children:[(0,S.jsxs)(F.A,{className:"mb16",children:[(0,S.jsx)(U.A,{span:6,children:(0,S.jsx)("div",{className:"ta-r",children:(0,S.jsxs)("strong",{children:[t("\u5f00\u59cb\u65f6\u95f4"),"\uff1a"]})})}),(0,S.jsx)(U.A,{span:18,children:n.startTime})]}),(0,S.jsxs)(F.A,{className:"mb16",children:[(0,S.jsx)(U.A,{span:6,children:(0,S.jsx)("div",{className:"ta-r",children:(0,S.jsxs)("strong",{children:[t("\u8fd0\u884c\u65f6\u957f"),"\uff1a"]})})}),(0,S.jsx)(U.A,{span:18,children:n.duration})]}),(0,S.jsxs)(F.A,{className:"mb16",children:[(0,S.jsx)(U.A,{span:6,children:(0,S.jsx)("div",{className:"ta-r",children:(0,S.jsxs)("strong",{children:[t("\u72b6\u6001"),"\uff1a"]})})}),(0,S.jsx)(U.A,{span:18,children:n.status})]}),(0,S.jsxs)(F.A,{className:"mb16",children:[(0,S.jsx)(U.A,{span:6,children:(0,S.jsx)("div",{className:"ta-r",children:(0,S.jsxs)("strong",{children:[t("\u5b50\u4efb\u52a1\u5185\u5bb9"),"\uff1a"]})})}),(0,S.jsx)(U.A,{span:18,children:n.content})]}),(0,S.jsxs)(F.A,{className:"mb16",children:[(0,S.jsx)(U.A,{span:6,children:(0,S.jsx)("div",{className:"ta-r",children:(0,S.jsxs)("strong",{children:[t("\u4efb\u52a1\u4fe1\u606f"),"\uff1a"]})})}),(0,S.jsx)(U.A,{span:18,children:n.message})]})]}),onOk(){}})},children:t("\u8be6\u60c5")}),"end"!==n.step||"success"!==n.status?(0,S.jsx)("span",{className:"link mr16",onClick:()=>{c.A.confirm({title:t("\u7ec8\u6b62\u4efb\u52a1"),icon:(0,S.jsx)(P.A,{}),content:"",okText:t("\u786e\u8ba4"),cancelText:t("\u53d6\u6d88"),onOk:()=>new Promise(((e,t)=>{f(n.reqId).then((t=>{e("")})).catch((e=>{t()}))})).then((e=>{r.Ay.success(t("\u7ec8\u6b62\u6210\u529f"))})).catch((()=>{r.Ay.error(t("\u7ec8\u6b62\u5931\u8d25"))})),onCancel(){}})},children:t("\u7ec8\u6b62")}):null,n.log?(0,S.jsx)("span",{className:"link mr16",onClick:()=>{window.open(n.log,"bank")},children:t("\u65e5\u5fd7")}):null,"end"===n.step&&"success"===n.status?(0,S.jsx)("span",{className:"link mr16",onClick:()=>{h(!0),g(n.reqId).then((e=>{o(!0);const n=e.data.result;y(n);const s=y(n);c.A.info({title:t("\u7ed3\u679c\u67e5\u770b"),content:(0,S.jsx)("div",{children:(0,S.jsx)(B.A,{size:"small",loading:!1,cancelExportData:!0,rowKey:e=>JSON.stringify(e),columns:s.config,pagination:!1,dataSource:s.data,scroll:{x:"auto"}})}),onOk(){}})})).catch((e=>{})).finally((()=>{h(!1)}))},children:t("\u7ed3\u679c")}):null,"end"===n.step&&"success"===n.status?(0,S.jsx)("span",{className:"link",onClick:()=>{var e;e=n.reqId,N.current=e,b(e),a(!0)},children:t("\u4e0b\u8f7d")}):null]})}],pagination:!1,dataSource:[{content:n.content,database:n.database||"-",table:n.table||"-",startime:n.startTime,duration:n.duration||"-",status:n.status}]})]},"task_".concat(s))))})]})}var G=n(25443),q=n.n(G),K=n(41029),W=n(41730),X=n(37429),J=n(50790),Q=n(63381);const $=u.forwardRef(((e,t)=>{const{t:n,i18n:s}=(0,_.Bd)(),[a]=J.A.useForm(),[,l]=(0,u.useState)();(0,u.useImperativeHandle)(t,(()=>({onSubmit:()=>new Promise(((e,t)=>{a.validateFields().then((t=>{e(t)})).catch((e=>{t(e)}))})),setData:e=>{a.setFieldsValue(e)}}))),(0,u.useEffect)((()=>{e.dataValue&&a.setFieldsValue(e.dataValue)}),[e.option]);const r=function(t){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};switch(t.type){case"input":return(0,S.jsx)("div",{});case"select":return((t,s)=>{const l=t.value||[];return(0,S.jsx)(J.A.Item,{label:t.label,name:t.id,rules:[{required:!0,message:"".concat(n("\u8bf7\u9009\u62e9")).concat(t.label)}],initialValue:t.defaultValue,style:{marginBottom:0,marginRight:16},...s,children:(0,S.jsx)(Q.A,{style:{width:200},mode:t.multiple?"multiple":void 0,showSearch:!0,disabled:t.disable,optionFilterProp:"label",placeholder:t.placeHolder||"".concat(n("\u8bf7\u9009\u62e9")," ").concat(t.label),options:l,onChange:(t,n)=>{if(n.relate){const t=n.relate.relateId,s=n.relate.value,a=e.option;for(let e=0;e<a.length;e++){const n=a[e];n.id===t&&(n.value=s)}e.onConfigChange&&e.onConfigChange(a)}e.onChange&&e.onChange(a.getFieldsValue())}})},"configFormData_".concat(t.id))})(t,s);case"input-select":return((t,s)=>{const l=(t.value||[]).map((e=>e.value));return(0,S.jsx)(J.A.Item,{label:t.label,name:t.id,rules:[{required:!0,message:"".concat(n("\u8bf7\u9009\u62e9")).concat(t.label)}],initialValue:t.defaultValue,style:{marginBottom:0},...s,children:(0,S.jsx)(k.A,{isOpenSearchMatch:!0,onChange:()=>{e.onChange&&e.onChange(a.getFieldsValue())},options:l,width:"500px"})},"configFormData_".concat(t.id))})(t,s);default:return null}};return(0,S.jsx)("div",{className:"configformdata-container d-f ac",children:(0,S.jsxs)(J.A,{form:a,component:!1,children:[console.log("props.option",e.option),e.option.map((e=>r(e)))]})})})),Z=(X.A.get("myapp_username"),()=>Math.random().toString(36).substring(2)),ee={test:"CREATE TABLE dbo.EmployeePhoto\n    (\n        EmployeeId INT NOT NULL PRIMARY KEY,\n        Photo VARBINARY(MAX) FILESTREAM NULL,\n        MyRowGuidColumn UNIQUEIDENTIFIER NOT NULL ROWGUIDCOL\n                        UNIQUE DEFAULT NEWID()\n    );\n    \n    GO\n    \n    /*\n    text_of_comment\n    /* nested comment */\n    */\n    \n    -- line comment\n    \n    CREATE NONCLUSTERED INDEX IX_WorkOrder_ProductID\n        ON Production.WorkOrder(ProductID)\n        WITH (FILLFACTOR = 80,\n            PAD_INDEX = ON,\n            DROP_EXISTING = ON);\n    GO\n    \n    WHILE (SELECT AVG(ListPrice) FROM Production.Product) < $300\n    BEGIN\n       UPDATE Production.Product\n          SET ListPrice = ListPrice * 2\n       SELECT MAX(ListPrice) FROM Production.Product\n       IF (SELECT MAX(ListPrice) FROM Production.Product) > $500\n          BREAK\n       ELSE\n          CONTINUE\n    END\n    PRINT 'Too much for the market to bear';\n    \n    MERGE INTO Sales.SalesReason AS [Target]\n    USING (VALUES ('Recommendation','Other'), ('Review', 'Marketing'), ('Internet', 'Promotion'))\n           AS [Source] ([NewName], NewReasonType)\n    ON [Target].[Name] = [Source].[NewName]\n    WHEN MATCHED\n    THEN UPDATE SET ReasonType = [Source].NewReasonType\n    WHEN NOT MATCHED BY TARGET\n    THEN INSERT ([Name], ReasonType) VALUES ([NewName], NewReasonType)\n    OUTPUT $action INTO @SummaryOfChanges;\n    \n    SELECT ProductID, OrderQty, SUM(LineTotal) AS Total\n    FROM Sales.SalesOrderDetail\n    WHERE UnitPrice < $5.00\n    GROUP BY ProductID, OrderQty\n    ORDER BY ProductID, OrderQty\n    OPTION (HASH GROUP, FAST 10);    \n"};function te(){const{t:e,i18n:t}=(0,_.Bd)(),n={tabId:Z(),title:"".concat(e("\u65b0\u67e5\u8be2")," 1"),status:"init",smartShow:!1,smartContent:"",smartCache:"",smartTimer:void 0,loading:!1,taskMap:{}},h=JSON.parse(localStorage.getItem("dataSearch2")||JSON.stringify({[n.tabId]:n})),x=Object.entries(h).reduce(((e,t)=>{let[n,s]=t;return[...e,{...s}]}),[]),[g,f]=(0,u.useState)(x[0].tabId),A=(0,u.useRef)(g),v=e=>{A.current=e,f(e)},[b,N]=(0,u.useState)(h),C=(0,u.useRef)(b),I=e=>{C.current=e,N(e)},[w,T]=(0,u.useState)([]),O=(0,u.useRef)(w),R=e=>{O.current=e,T(e)},P=Object.entries(b).reduce(((e,t)=>{let[n,s]=t;return[...e,{...s}]}),[]),[M,D]=(0,u.useState)(P),L=(0,u.useRef)(x.length),[H,F]=(0,u.useState)([]),[U,B]=(0,u.useState)([]),z=(0,u.useRef)(null),V=(e,t)=>{const n={...C.current};let s={};e.taskMap&&(s={taskMap:{...C.current[g].taskMap,...e.taskMap}}),n[t||g]={...n[t||g],...e,...s},localStorage.setItem("dataSearch2",JSON.stringify(n)),C.current=n,I(n)};(0,u.useEffect)((()=>{j().then((e=>{const t=e.data.result;R(t)}))}),[]),(0,u.useEffect)((()=>{const e=document.getElementById("buttonDrag");var t;e&&((t=e).onmousedown=function(e){var n="",s=e.clientX,a=e.clientY,l=t.offsetWidth,r=t.offsetHeight,c=t.offsetLeft,o=t.offsetTop;return s>c+l-30?n="right":s<c+30&&(n="left"),a>o+r-30?n="down":a<o+30&&(n="top"),document.onmousemove=function(e){switch(n){case"right":t.style.width=l+(e.clientX-s)+"px";break;case"left":t.style.width=l-(e.clientX-s)+"px",t.style.left=c+(e.clientX-s)+"px";break;case"top":t.style.height=r-(e.clientY-a)+"px",t.style.top=o+(e.clientY-a)+"px";break;case"down":t.style.height=r+(e.clientY-a)+"px"}},t.onmouseup=function(){document.onmousemove=null},!1})}),[]);const G=e=>{Object.entries(C.current[e]).reduce(((e,t)=>{let[n,s]=t;return[...e,{...s}]}),[]).forEach((e=>{clearInterval(e.smartTimer)}));Object.entries(C.current[e].taskMap).reduce(((e,t)=>{let[n,s]=t;return[...e,{...s}]}),[]).forEach((e=>{clearInterval(e.timer)}))},X=(e,t)=>{const n=C.current[e].taskMap[t];n&&clearInterval(n.timer)};(0,u.useEffect)((()=>(V({loading:!1}),()=>{Object.entries(b).forEach((e=>{const[t]=e;G(t)}))})),[]),(0,u.useEffect)((()=>{const e=b[g];Object.entries(e.taskMap).reduce(((e,t)=>{let[n,s]=t;return[...e,{...s}]}),[]).forEach((e=>{"running"===e.status&&Q(e.reqId)}))}),[g]);const J=t=>{p(t).then((e=>{const{state:n,result:s,err_msg:a,result_url:l,spark_log_url:r,stage:c}=e.data,o={...C.current[g].taskMap[t],status:n,step:c,log:r,downloadUrl:l,result:s,message:a};if("success"===n||"failure"===n){const e=new Date(o.startTime||"").valueOf(),n=(new Date).valueOf(),s=(0,K._0)((n-e)/1e3);o.duration=s,V({status:"success",taskMap:{[t]:o}}),X(g,t)}else V({status:"success",taskMap:{[t]:o}})})).catch((()=>{X(g,t),r.Ay.error(e("\u67e5\u8be2\u7ed3\u679c\u5931\u8d25\uff0c\u5c1d\u8bd5\u91cd\u65b0\u8fd0\u884c")),V({status:"failure",taskMap:{[t]:{...C.current[g].taskMap[t],status:"failure",step:"end"}}})}))},Q=t=>{X(g,t);let n=setInterval((()=>{J(t)}),5e3);V({taskMap:{[t]:{reqId:t,status:"init",content:b[g].content,name:"".concat(e("\u4efb\u52a1")).concat(t),step:"start",startTime:q()().format("YYYY-MM-DD HH:mm:ss"),database:b[g].database,table:b[g].table,timer:n,message:""}}}),J(t)};return(0,S.jsx)("div",{className:"datasearch-container fade-in d-f",children:(0,S.jsx)("div",{className:"flex1 ptb16 pl16",children:(0,S.jsx)(o.A,{type:"editable-card",onChange:e=>{Object.entries(b).forEach((t=>{const[n]=t;n!==e&&G(n)})),F([]),B([]),v(e)},activeKey:g,onEdit:(t,n)=>{"add"===n?(()=>{G(g);const t=++L.current;if(t>10)r.Ay.warn(e("\u6807\u7b7e\u6570\u76ee\u8fbe\u5230\u9650\u5236"));else{const n=Z(),s="".concat(e("\u65b0\u67e5\u8be2")," ").concat(t),a=[...M],l={title:s,tabId:n,status:"init",smartShow:!1,smartContent:"",smartTimer:void 0,smartCache:"",loading:!1,taskMap:{}};a.push(l),D(a),v(n);let r={...b,[n]:l};I(r),localStorage.setItem("dataSearch2",JSON.stringify(r))}})():(e=>{let t=g,n=-1;M.forEach(((t,s)=>{t.tabId===e&&(n=s-1)}));const s=M.filter((t=>t.tabId!==e));s.length&&t===e&&(t=n>=0?s[n].tabId:s[0].tabId),D(s),v(t);let a={...b};delete a[e],I(a),localStorage.setItem("dataSearch2",JSON.stringify(a))})(t)},children:M.map(((t,n)=>{var r,u;return(0,S.jsx)(o.A.TabPane,{tab:"".concat(e("\u65b0\u67e5\u8be2")," ").concat(n+1),closable:0!==n,children:(0,S.jsxs)("div",{className:"d-f fd-c h100",children:[(0,S.jsxs)("div",{className:"flex2 s0 ov-a",children:[null!==(r=b[g])&&void 0!==r&&r.loading?(0,S.jsx)("div",{className:"codeedit-mark",children:(0,S.jsxs)("div",{className:"d-f jc ac fd-c",children:[(0,S.jsx)(W.A,{}),(0,S.jsx)("div",{children:e("\u7ed3\u679c\u751f\u6210\u4e2d")})]})}):null,(0,S.jsx)(y,{value:null===(u=b[g])||void 0===u?void 0:u.content,onChange:e=>{V({content:""===e?void 0:e,title:t.title})}})]}),(0,S.jsxs)("div",{className:"ov-h",id:"showBox",style:{height:500},children:[(0,S.jsx)(E(),{axis:"y",onStart:()=>{},onDrag:e=>{const t=document.getElementById("showBox");if(t){const n=document.body.clientHeight-e.y;t.style.height="".concat(n,"px")}},onStop:()=>{},children:(0,S.jsx)("div",{className:"ta-c",style:{cursor:"ns-resize"},children:(0,S.jsx)(a.A,{})})}),(0,S.jsxs)("div",{className:"ptb8 plr16 bor-l bor-r b-side d-f ac jc-b bg-w",children:[(0,S.jsxs)("div",{className:"d-f ac",children:[(0,S.jsx)(i.A,{className:"mr8",checked:b[g].smartShow,unCheckedChildren:e("\u6b63\u5e38\u6a21\u5f0f"),checkedChildren:e("\u667a\u80fd\u6a21\u5f0f"),onChange:e=>{V({smartShow:e})}}),b[g].smartShow?(0,S.jsx)(k.A,{value:b[g].smartContent,isOpenSearchMatch:!0,onChange:e=>{V({smartContent:e})},onSearch:e=>{V({smartCache:ee[e],loading:!0});const t=setInterval((()=>{const e=C.current[g].content||"";if(C.current[g].smartCache){let t=C.current[g].smartCache||"";const n=t.substr(0,20);t=t.replace(n,""),V({smartCache:t,content:e+n})}else clearInterval(C.current[g].smartTimer),V({smartCache:"",smartTimer:void 0,loading:!1})}),800);V({smartTimer:t})},options:["test"],placeholder:e("AI\u667a\u80fd\u751f\u6210(\u4f01\u4e1a\u7248)"),width:"240px"}):null]}),(0,S.jsxs)("div",{className:"d-f ac",children:[(0,S.jsx)($,{ref:z,dataValue:b[g],onChange:e=>{V(e)},onConfigChange:e=>{R(e),V({database:"db"})},option:O.current}),(0,S.jsxs)(d.A,{className:"ml16",type:"primary",loading:"running"===b[g].status,onClick:()=>{z.current.onSubmit().then((t=>{(()=>{var t;V({status:"running"});const n=w.map((e=>e.id)).reduce(((e,t)=>({...e,[t]:b[g][t]})),{});m({sql:(null===(t=b[g])||void 0===t?void 0:t.content)||"",...n}).then((t=>{const{err_msg:n,task_id:a}=t.data;n?(V({status:"failure"}),c.A.error({title:e("\u8fd0\u884c\u5931\u8d25"),icon:(0,S.jsx)(s.A,{}),width:1e3,content:n,okText:e("\u5173\u95ed")})):a&&Q(a)})).catch((e=>{V({status:"failure"})}))})()}))},children:[e("\u8fd0\u884c"),(0,S.jsx)(l.A,{})]})]})]}),(0,S.jsxs)("div",{className:"flex1 bor b-side s0 bg-w p-r ov-a",style:{height:"calc(100% - 80px)"},children:[(0,S.jsx)("div",{className:"pt8",children:(0,S.jsx)("div",{className:"tag-result bg-theme c-text-w mr16",children:e("\u7ed3\u679c")})}),(0,S.jsx)("div",{className:"plr16 pt8",children:(0,S.jsx)(Y,{option:b[g].taskMap,onDelete:t=>{c.A.confirm({title:e("\u5220\u9664"),icon:(0,S.jsx)(s.A,{}),content:"".concat(e("\u786e\u5b9a\u5220\u9664"),"?"),okText:e("\u786e\u8ba4\u5220\u9664"),cancelText:e("\u53d6\u6d88"),okButtonProps:{danger:!0},onOk(){let e=b[g].taskMap;X(g,t),delete e[t],V({taskMap:e})},onCancel(){}})},onRetry:e=>{Q(e)}})})]})]})]})},t.tabId)}))})})})}}}]);
//# sourceMappingURL=646.cba8d054.chunk.js.map